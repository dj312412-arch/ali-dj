<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø³Ø§ÛŒØª Ø¹Ù„ÛŒ Ù‚Ø±Ø¨Ø§Ù†ÛŒ â€” ÙØ±ÙˆØ´Ú¯Ø§Ù‡ØŒ ÙˆØ¨Ù„Ø§Ú¯ØŒ Ø¹Ø¶ÙˆÛŒØª</title>
  <meta name="description" content="Ø¹Ù„ÛŒ Ù‚Ø±Ø¨Ø§Ù†ÛŒ  Ø¨Ø§ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ØŒ ÙˆØ¨Ù„Ø§Ú¯ØŒ Ø¹Ø¶ÙˆÛŒØª Ùˆ ÙØ±Ù… ØªÙ…Ø§Ø³ Ø¯Ø± ÛŒÚ© ØµÙØ­Ù‡â€ŒÛŒ Ù…ÛŒÙ†ÛŒÙ…Ø§Ù„ Ùˆ ÙˆØ§Ú©Ù†Ø´â€ŒÚ¯Ø±Ø§.">
  <style>
    :root{
      --bg:#ffffff; --text:#1b1f2a; --muted:#5b6275; --pri:#111827; --acc:#13ff02; --soft:#a805f9; --line:#080808;
      --radius:14px; --shadow:0 10px 30px rgba(17,24,39,.08); --max:1100px;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,"Vazirmatn",Tahoma;line-height:1.6;background:var(--bg);color:var(--text)}
    a{color:var(--acc);text-decoration:none}
    img{max-width:100%;height:auto;border-radius:12px}
    .wrap{max-width:var(--max);margin:auto;padding:0 20px}
    header{position:sticky;top:0;background:rgba(255,255,255,.8);backdrop-filter:saturate(160%) blur(10px);border-bottom:1px solid var(--line);z-index:50}
    .nav{display:flex;align-items:center;justify-content:space-between;height:68px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--acc)}
    .menu{display:flex;gap:16px;align-items:center}
    .menu a{color:var(--muted)}
    .chip{display:inline-flex;align-items:center;gap:6px;background:var(--soft);color:#334155;border:1px solid var(--line);border-radius:999px;padding:6px 10px;font-size:12px}
    .btn{display:inline-flex;gap:8px;align-items:center;border-radius:12px;padding:10px 16px;font-weight:700;cursor:pointer;border:1px solid #0f172a10;background:#111827;color:#fff}
    .btn.ghost{background:#fff;color:var(--text);border:1px solid var(--line)}
    .btn.acc{background:var(--acc);border-color:var(--acc)}
    .icon{width:18px;height:18px;display:inline-block}
    .hero{padding:60px 0}
    .hero .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:32px;align-items:center}
    h1{font-size:40px;line-height:1.15;margin:12px 0}
    .lead{color:var(--muted);font-size:16px;margin-bottom:18px}
    section{padding:40px 0}
    h2{font-size:22px;margin:0 0 16px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .card{background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
    .price{font-weight:800}
    .muted{color:var(--muted)}
    .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .cart-btn{position:relative}
    .badge{position:absolute;top:-8px;left:-8px;background:#00ff22;color:#fff;border-radius:999px;padding:2px 6px;font-size:11px}
    .bar{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .pill{display:inline-flex;gap:8px;background:var(--soft);border:1px solid var(--line);padding:6px 10px;border-radius:999px}
    .field{display:flex;flex-direction:column;gap:6px}
    input,textarea,select{padding:12px;border:1px solid var(--line);border-radius:10px;background:#fff;color:var(--text);font:inherit}
    textarea{min-height:120px;resize:vertical}
    .fine{font-size:13px;color:#6b7280}
    footer{padding:28px 0;border-top:1px solid var(--line);color:#6b7280;margin-top:20px}
    /* Cart drawer */
    .drawer{position:fixed;inset:0 0 0 auto;display:none}
    .drawer.active{display:block}
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,.2)}
    .panel{position:absolute;right:0;top:0;bottom:0;width:360px;max-width:95vw;background:#fff;border-left:1px solid var(--line);box-shadow:var(--shadow);display:flex;flex-direction:column}
    .panel header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line)}
    .panel .body{padding:16px;overflow:auto;flex:1}
    .panel .foot{padding:16px;border-top:1px solid var(--line)}
    .cart-item{display:grid;grid-template-columns:60px 1fr auto;gap:10px;align-items:center;margin-bottom:12px}
    .qty{display:inline-flex;border:1px solid var(--line);border-radius:10px;overflow:hidden}
    .qty button{background:#fff;border:0;padding:6px 10px;cursor:pointer}
    .qty span{padding:0 10px;border-inline:1px solid var(--line)}
    /* Blog */
    .post{display:flex;flex-direction:column;gap:10px}
    .comments{margin-top:10px;border-top:1px solid var(--line);padding-top:10px}
    .comment{background:var(--soft);border:1px solid var(--line);border-radius:10px;padding:10px;margin-top:8px}
    /* Auth */
    .tabs{display:flex;gap:8px;margin-bottom:14px}
    .tab{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;cursor:pointer}
    .tab.active{background:var(--acc);border-color:var(--acc);color:#fff}
    .hidden{display:none !important}
    @media (max-width: 940px){
      .hero .grid{grid-template-columns:1fr}
      .grid{grid-template-columns:1fr}
      h1{font-size:32px}
      header .menu .hide-sm{display:none}
    }
  </style>
</head>
<body>

  <header>
    <div class="wrap nav">
      <div class="brand">
        <span class="dot"></span>
        <span>Ø³Ø§ÛŒØª Ø¹Ù„ÛŒ Ù‚Ø±Ø¨Ø§Ù†ÛŒ  | Personal</span>
      </div>
      <nav class="menu">
        <a href="#about">Ø¯Ø±Ø¨Ø§Ø±Ù‡</a>
        <a href="#products">Ù…Ø­ØµÙˆÙ„Ø§Øª</a>
        <a href="#blog" class="hide-sm">ÙˆØ¨Ù„Ø§Ú¯</a>
        <a href="#auth" class="hide-sm">Ø¹Ø¶ÙˆÛŒØª</a>
        <a href="#contact" class="hide-sm">ØªÙ…Ø§Ø³</a>
        <button id="cartBtn" class="btn ghost cart-btn" title="Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯">
          <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M3 3h2l.4 2M7 13h10l3-8H6.4M7 13L5.4 5M7 13l-2 9m12-9l-2 9" stroke="#111827" stroke-width="1.5" stroke-linecap="round"/></svg>
          <span id="cartCount" class="badge">0</span>
        </button>
        <button id="userBtn" class="btn ghost" title="Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ">
          <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z" stroke="#111827" stroke-width="1.5"/></svg>
          <span id="userLabel" class="muted">ÙˆØ±ÙˆØ¯</span>
        </button>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section id="about" class="hero">
      <div class="grid">
        <div>
          <span class="chip">Ù…ÛŒÙ†ÛŒÙ…Ø§Ù„ â€¢ Ø³Ø±ÛŒØ¹ â€¢ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ</span>
          <h1>Ø³Ù„Ø§Ù…ØŒ Ù…Ù† Ø¹Ù„ÛŒ Ù‚Ø±Ø¨Ø§Ù†ÛŒ Ù‡Ø³ØªÙ… â€” Ù…ØªØ±Ø¬Ù… Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ Ø§Ø¯ÛŒØªÙˆØ± Ø¹Ú©Ø³ ØªØ§ÛŒÙ¾ÛŒØ³Øª</h1>
          <p class="lead">ØªØ±Ú©ÛŒØ¨ Ù…Ø¹Ø±ÙÛŒ Ø´Ø®ØµÛŒØŒ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ùˆ ÙˆØ¨Ù„Ø§Ú¯Ø› Ø¬Ø§ÛŒÛŒ Ú©Ù‡ Ù‡Ù… Ø®ÙˆØ¯ØªÙˆ Ù…ÛŒâ€ŒÙ†Ù…Ø§ÛŒÙˆÙ†ÛŒØŒ Ù‡Ù… Ù…ÛŒâ€ŒÙØ±ÙˆØ´ÛŒØŒ Ù‡Ù… Ø­Ø±Ù Ù…ÛŒâ€ŒØ²Ù†ÛŒ. </p>
          <div class="row">
            <a class="btn acc" href="#products">Ø¯ÛŒØ¯Ù† Ù…Ø­ØµÙˆÙ„Ø§Øª</a>
            <a class="btn ghost" href="#blog">Ø®ÙˆØ§Ù†Ø¯Ù† ÙˆØ¨Ù„Ø§Ú¯</a>
          </div>
        </div>
        <div>
          <img src="https://uploadkon.ir/uploads/35be19_25Jowhareh-galleries-8-poster-9278af39-b767-4dd0-a73f-85c846fbebcc.png" alt="Ù¾Ø±ÙˆÙØ§ÛŒÙ„.Ù…Ø­ÛŒØ· Ú©Ø§Ø±:>
        </div>
      </div>
    </section>

    <section id="products">
      <div class="bar">
        <h2>ğŸ›’ Ù…Ø­ØµÙˆÙ„Ø§Øª</h2>
        <div class="pill">
          <span class="muted">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ:</span>
          <select id="sortSelect">
            <option value="default">Ù¾ÛŒØ´â€ŒÙØ±Ø¶</option>
            <option value="priceAsc">Ù‚ÛŒÙ…Øª (Ø§Ø±Ø²Ø§Ù†â€ŒØªØ±)</option>
            <option value="priceDesc">Ù‚ÛŒÙ…Øª (Ú¯Ø±Ø§Ù†â€ŒØªØ±)</option>
          </select>
        </div>
      </div>
      <div id="productsGrid" class="grid"></div>
    </section>

    <section id="blog">
      <h2>ğŸ“ ÙˆØ¨Ù„Ø§Ú¯</h2>
      <div id="postsGrid" class="grid"></div>
    </section>

    <section id="auth">
      <h2>ğŸ‘¤ Ø¹Ø¶ÙˆÛŒØª Ùˆ ÙˆØ±ÙˆØ¯</h2>
      <div class="tabs">
        <button class="tab active" data-tab="signup">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
        <button class="tab" data-tab="login">ÙˆØ±ÙˆØ¯</button>
      </div>
      <div id="signupPane">
        <form id="signupForm" class="grid">
          <div class="card">
            <div class="field">
              <label>Ù†Ø§Ù… Ú©Ø§Ù…Ù„</label>
              <input name="name" placeholder="Ù…Ø«Ù„Ø§ Ø±Ø¶Ø§" required>
            </div>
            <div class="field">
              <label>Ø§ÛŒÙ…ÛŒÙ„</label>
              <input name="email" type="email" placeholder="" required>
            </div>
            <div class="field">
              <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
              <input name="password" type="password" placeholder="Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ±" minlength="6" required>
            </div>
            <button class="btn acc" type="submit">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
            <span class="fine">Ø¨Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ø­Ø³Ø§Ø¨ØŒ Ø´Ø±Ø§ÛŒØ· Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÛŒØ¯.</span>
          </div>
          <div class="card">
            <h3>Ù…Ø²Ø§ÛŒØ§ÛŒ Ø¹Ø¶ÙˆÛŒØª</h3>
            <ul>
              <li>Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</li>
              <li>Ø§Ø±Ø³Ø§Ù„ Ù†Ø¸Ø± Ø¨Ø§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</li>
              <li>Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ØªØ®ÙÛŒÙâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡</li>
            </ul>
          </div>
        </form>
      </div>
      <div id="loginPane" class="hidden">
        <form id="loginForm" class="card">
          <div class="field">
            <label>Ø§ÛŒÙ…ÛŒÙ„</label>
            <input name="email" type="email" required>
          </div>
          <div class="field">
            <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
            <input name="password" type="password" required>
          </div>
          <button class="btn acc" type="submit">ÙˆØ±ÙˆØ¯</button>
          <span class="fine">Ù‡Ù†ÙˆØ² Ø­Ø³Ø§Ø¨ Ù†Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø±ÙˆÛŒ ØªØ¨ Â«Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…Â» Ø¨Ø²Ù†ÛŒØ¯.</span>
        </form>
      </div>
      <div id="accountPane" class="hidden card" style="margin-top:12px">
        <h3>Ø³Ù„Ø§Ù… <span id="accountName"></span> ğŸ‘‹</h3>
        <p class="muted">Ø§ÛŒÙ…ÛŒÙ„: <span id="accountEmail"></span></p>
        <div class="row">
          <button id="logoutBtn" class="btn ghost">Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>
    </section>

    <section id="contact">
      <h2>ğŸ“© ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</h2>
      <form id="contactForm" class="grid">
        <div class="card">
          <div class="field">
            <label>Ù†Ø§Ù…</label>
            <input name="name" placeholder="Ù†Ø§Ù… Ø´Ù…Ø§" required>
          </div>
          <div class="field">
            <label>Ø§ÛŒÙ…ÛŒÙ„</label>
            <input name="email" type="email" placeholder="dj312412@gmail.com" required>
          </div>
          <div class="field">
            <label>Ù¾ÛŒØ§Ù…</label>
            <textarea name="message" placeholder="Ø³Ù„Ø§Ù…..." required></textarea>
          </div>
          <button class="btn acc" type="submit">Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…</button>
          <span class="fine">Ø¯Ø± Ú©Ù…ØªØ± Ø§Ø² Û²Û´ Ø³Ø§Ø¹Øª Ù¾Ø§Ø³Ø® Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ….</span>
        </div>
        <div class="card">
          <h3>Ø±Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø·ÛŒ</h3>
          <p class="muted">Ø§ÛŒÙ…ÛŒÙ„: dj312412@gmail.com<br> <br>Ù„ÙˆÚ©ÛŒØ´Ù†: Ù‚Ø²ÙˆÛŒÙ†</p>
          <h3>Ú†Ø·ÙˆØ± Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…</h3>
          <p class="fine">Û±) Ú©Ø´Ù Ù†ÛŒØ§Ø² â€¢ Û²) Ù†Ù…ÙˆÙ†Ù‡ Ø§ÙˆÙ„ÛŒÙ‡ â€¢ Û³) Ø§Ø¬Ø±Ø§ Ùˆ ØªØ­ÙˆÛŒÙ„ â€¢ Û´) Ø¨Ù‡Ø¨ÙˆØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙÛŒØ¯Ø¨Ú©</p>
        </div>
      </form>
    </section>
  </main>

  <footer>
    <div class="wrap">Â© 2025  â€”  Ø¢Ù…Ø§Ø¯Ù‡â€ŒÛŒ Ø±Ø´Ø¯</div>
  </footer>

  <!-- Cart Drawer -->
  <div id="cartDrawer" class="drawer" aria-hidden="true">
    <div class="overlay" id="cartOverlay"></div>
    <div class="panel">
      <header class="nav">
        <strong>Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</strong>
        <button id="closeCart" class="btn ghost">Ø¨Ø³ØªÙ†</button>
      </header>
      <div class="body">
        <div id="cartItems"></div>
      </div>
      <div class="foot">
        <div class="bar">
          <span class="muted">Ø¬Ù…Ø¹ Ú©Ù„:</span>
          <strong id="cartTotal" class="price">0 â‚¬</strong>
        </div>
        <div class="row">
          <button id="checkoutBtn" class="btn acc" style="flex:1">ØªØ³ÙˆÛŒÙ‡ Ø­Ø³Ø§Ø¨</button>
          <button id="clearCartBtn" class="btn ghost">Ø®Ø§Ù„ÛŒ Ú©Ø±Ø¯Ù†</button>
        </div>
        <span class="fine">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.</span>
      </div>
    </div>
  </div>

  <script>
  // ---------- Data ----------
  const state = {
    products: [
      {id:'p1', title:'ØªØ±Ø¬Ù…Ù‡ Ù…ØªÙ† ÛŒÚ© ØµÙØ®Ù‡ Ø§ÛŒ Ø¯Ø± ÛŒÚ© Ø±ÙˆØ²', price:225000, img:"https://uploadkon.ir/uploads/0d6d19_25Jowhareh-galleries-8-poster-70db6863-573e-4b4b-bb54-108fda8cf7ff.png", desc:" 300Ù‚ÛŒÙ…Øª Ø§Ø² 150 ØªØ§", stock:1000},
      {id:'p2', title:"ØªØ±Ø¬Ù…Ù‡ Ù…ØªÙ† Ø¯ÙˆØµÙØ­Ù‡ Ø§ÛŒ Ø¯Ø± Ø¯ÙˆØ±ÙˆØ²", price:325000, img:'https://uploadkon.ir/uploads/261419_25Jowhareh-galleries-8-poster-cee8190d-2c00-4fbe-8293-acd0b05b6fe2.jpeg', desc:"Ù‚ÛŒÙ…Øª Ø§Ø² 250 ØªØ§ 400", stock:1000},
      {id:'p3', title:"ØªØ±Ø¬Ù…Ù‡ Ù…ØªÙ† Ø³Ù‡ ØµÙØ­Ù‡ Ø§ÛŒ Ø¯Ø± Ø³Ù‡Ø±ÙˆØ²", price:425000, img:'https://uploadkon.ir/uploads/0d6d19_25Jowhareh-galleries-8-poster-70db6863-573e-4b4b-bb54-108fda8cf7ff.png', desc:"Ù‚ÛŒÙ…Øª Ø§Ø² 350 ØªØ§500", stock:1000},
      {id:'p4', title:"ØªØ±Ø¬Ù…Ù‡ Ù…ØªÙ† Ø³Ù‡ ØµÙØ­Ù‡ Ø§ÛŒ Ø¯Ø± Ú†Ù‡Ø§Ø±Ø±ÙˆØ²", price:525000, img:'https://uploadkon.ir/uploads/4b0419_25Jowhareh-galleries-8-poster-f8f67b3e-81d5-4ebe-847b-8f6fd7e8f924.png', desc:"Ù‚ÛŒÙ…Øª Ø§Ø² 450 ØªØ§ 600", stock:1000},
      {id:'p5', title:"ØªØ±Ø¬Ù…Ù‡ ØªØ®ØµØµÛŒ", price:0, img:'https://uploadkon.ir/uploads/af9b19_25Jowhareh-galleries-8-poster-6941fb6a-472f-4072-a174-82323f1171f0.png', desc:"Ù‚ÛŒÙ…Øª ØªÙˆØ§ÙÙ‚ÛŒ", stock:1000},
      {id:'p6', title:"Ø³Ø§ÛŒØ± Ø®Ø¯Ù…Ø§Øª", price:0, img:'https://uploadkon.ir/uploads/3fe319_25adobe-photoshop-logo.png', desc:"Ù‚ÛŒÙ…Øª ØªÙˆØ§ÙÙ‚ÛŒ", stock:1000},
    ],
    posts: [
      {id:'b1', title:"Ú©Ø§Ø±Ù‡Ø§ÛŒ ØªØ±Ø¬Ù‡ ÛŒ Ù…Ù†", img:'https://uploadkon.ir/uploads/2c8f19_25Untitled-1.jpg', excerpt:'ØªØ±Ø¬Ù…Ù‡ Ø¨Ø§ ØªØ¬Ø±Ø¨Ù‡ 2 Ø³Ø§Ù„Ù‡', content:""},
      {id:'b2', title:"  Ú©Ø§Ø±Ù‡Ø§ÛŒ ÙØªÙˆØ´Ø§Ù¾", img:'https://uploadkon.ir/uploads/8bbd19_253.jpg', excerpt:'Ú©Ø§Ø± Ø¨Ø§ ÙØªÙˆØ´Ø§Ù¾ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø¨Ø§ Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ù†Ø§Ø³Ø¨', content:""},
      {id:'b3', title:"Ú©Ø§Ø± Ù‡Ø§ÛŒ ØªØ§ÛŒÙ¾ Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ÛŒ Ù…Ù†", img:'https://uploadkon.ir/uploads/446c19_25Screenshot-2025-08-20-000548.png', excerpt:'ØªØ§ÛŒÙ¾ Ø­Ø±Ù Ø§ÛŒ Ùˆ Ø³Ø±ÛŒØ¹', content:""},
    ],
    cart: JSON.parse(localStorage.getItem('cart')||'[]'),
    user: JSON.parse(localStorage.getItem('user')||'null')
  };

  // ---------- Helpers ----------
  const fmt = n => new Intl.NumberFormat('de-DE',{style:'currency',currency:'EUR'}).format(n);
  const q = (s,root=document)=>root.querySelector(s);
  const qa = (s,root=document)=>[...root.querySelectorAll(s)];
  const saveCart = ()=>localStorage.setItem('cart', JSON.stringify(state.cart));
  const saveUser = ()=>state.user?localStorage.setItem('user', JSON.stringify(state.user)):localStorage.removeItem('user');

  // ---------- Render Products ----------
  const productsGrid = q('#productsGrid');
  function renderProducts(list=state.products){
    productsGrid.innerHTML = '';
    list.forEach(p=>{
      const el = document.createElement('article');
      el.className = 'card';
      el.innerHTML = `
        <img src="${p.img}" alt="${p.title}">
        <h3>${p.title}</h3>
        <p class="muted">${p.desc}</p>
        <div class="bar">
          <span class="price">${fmt(p.price)}</span>
          <span class="fine">Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${p.stock}</span>
        </div>
        <div class="row">
          <button class="btn acc" data-add="${p.id}">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯</button>
          <button class="btn ghost" data-buy="${p.id}">Ø®Ø±ÛŒØ¯ ÙÙˆØ±ÛŒ</button>
        </div>`;
      productsGrid.appendChild(el);
    });
  }
  renderProducts();

  // Sorting
  q('#sortSelect').addEventListener('change', e=>{
    const v = e.target.value;
    let list = [...state.products];
    if(v==='priceAsc') list.sort((a,b)=>a.price-b.price);
    if(v==='priceDesc') list.sort((a,b)=>b.price-a.price);
    renderProducts(list);
  });

  // ---------- Cart ----------
  const cartBtn = q('#cartBtn'), cartDrawer = q('#cartDrawer'), cartCount = q('#cartCount');
  const cartItems = q('#cartItems'), cartTotal = q('#cartTotal');
  const openCart = ()=>{cartDrawer.classList.add('active');cartDrawer.setAttribute('aria-hidden','false')};
  const closeCart = ()=>{cartDrawer.classList.remove('active');cartDrawer.setAttribute('aria-hidden','true')};
  q('#closeCart').onclick = closeCart; q('#cartOverlay').onclick = closeCart;

  function addToCart(id, qty=1){
    const product = state.products.find(p=>p.id===id); if(!product) return;
    const item = state.cart.find(i=>i.id===id);
    if(item) item.qty += qty; else state.cart.push({id, qty});
    saveCart(); updateCartUI();
  }
  function setQty(id, qty){
    const it = state.cart.find(i=>i.id===id); if(!it) return;
    it.qty = Math.max(1, qty|0); saveCart(); updateCartUI();
  }
  function removeItem(id){
    state.cart = state.cart.filter(i=>i.id!==id); saveCart(); updateCartUI();
  }
  function cartSum(){
    return state.cart.reduce((sum,i)=>{
      const p = state.products.find(p=>p.id===i.id); return sum + (p?p.price*i.qty:0);
    },0);
  }
  function updateCartUI(){
    cartCount.textContent = state.cart.reduce((n,i)=>n+i.qty,0);
    cartItems.innerHTML = '';
    state.cart.forEach(i=>{
      const p = state.products.find(p=>p.id===i.id);
      if(!p) return;
      const row = document.createElement('div');
      row.className = 'cart-item';
      row.innerHTML = `
        <img src="${p.img}" alt="${p.title}">
        <div>
          <strong>${p.title}</strong>
          <div class="fine">${fmt(p.price)} / ÙˆØ§Ø­Ø¯</div>
          <div class="qty" role="group" aria-label="ØªØ¹Ø¯Ø§Ø¯">
            <button data-dec="${i.id}" aria-label="Ú©Ø§Ù‡Ø´">âˆ’</button>
            <span>${i.qty}</span>
            <button data-inc="${i.id}" aria-label="Ø§ÙØ²Ø§ÛŒØ´">+</button>
          </div>
        </div>
        <div style="text-align:end">
          <div class="price">${fmt(p.price*i.qty)}</div>
          <button class="fine" data-remove="${i.id}" style="background:none;border:0;color:#ef4444;cursor:pointer">Ø­Ø°Ù</button>
        </div>`;
      cartItems.appendChild(row);
    });
    cartTotal.textContent = fmt(cartSum());
  }
  updateCartUI();

  // Product buttons delegation
  productsGrid.addEventListener('click', e=>{
    const add = e.target.closest('[data-add]'); const buy = e.target.closest('[data-buy]');
    if(add){ addToCart(add.getAttribute('data-add'),1); openCart(); }
    if(buy){ addToCart(buy.getAttribute('data-buy'),1); openCart(); }
  });

  // Cart interactions
  cartItems.addEventListener('click', e=>{
    const inc = e.target.closest('[data-inc]'); const dec = e.target.closest('[data-dec]'); const rem = e.target.closest('[data-remove]');
    if(inc) setQty(inc.dataset.inc, (state.cart.find(i=>i.id===inc.dataset.inc)?.qty||1) + 1);
    if(dec) setQty(dec.dataset.dec, (state.cart.find(i=>i.id===dec.dataset.dec)?.qty||1) - 1);
    if(rem) removeItem(rem.dataset.remove);
  });
  q('#checkoutBtn').addEventListener('click', ()=>{
    if(state.cart.length===0){ alert('Ø³Ø¨Ø¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.'); return; }
    // Mock checkout
    const name = state.user?.name || 'Ù…Ø´ØªØ±ÛŒ Ø¹Ø²ÛŒØ²';
    alert(`${name}ØŒ Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø¨Ø§ Ù…Ø¨Ù„Øº ${fmt(cartSum())} Ø«Ø¨Øª Ø´Ø¯ (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ).`);
    state.cart = []; saveCart(); updateCartUI(); closeCart();
  });
  q('#clearCartBtn').addEventListener('click', ()=>{ state.cart=[]; saveCart(); updateCartUI(); });

  cartBtn.addEventListener('click', openCart);

  // ---------- Blog + Comments ----------
  const postsGrid = q('#postsGrid');
  function getComments(postId){
    return JSON.parse(localStorage.getItem('comments:'+postId) || '[]');
  }
  function saveComments(postId, list){
    localStorage.setItem('comments:'+postId, JSON.stringify(list));
  }
  function renderPost(p){
    const wrap = document.createElement('article'); wrap.className='card post';
    const comments = getComments(p.id);
    wrap.innerHTML = `
      <img src="${p.img}" alt="${p.title}">
      <h3>${p.title}</h3>
      <p class="muted">${p.excerpt}</p>
      <details>
        <summary>Ø§Ø¯Ø§Ù…Ù‡ Ù…Ø·Ù„Ø¨</summary>
        <p style="margin-top:10px">${p.content}</p>
      </details>
      <div class="comments" id="cwrap-${p.id}">
        <strong>Ù†Ø¸Ø±Ø§Øª (${comments.length})</strong>
        <div id="clist-${p.id}"></div>
        <form id="cform-${p.id}" class="row" style="margin-top:10px;flex-direction:column;align-items:stretch">
          <input name="name" placeholder="Ù†Ø§Ù…" value="${state.user?.name||''}" required>
          <textarea name="text" placeholder="Ù†Ø¸Ø± Ø´Ù…Ø§..." required></textarea>
          <button class="btn acc" type="submit">Ø§Ø±Ø³Ø§Ù„ Ù†Ø¸Ø±</button>
        </form>
        <span class="fine">Ù†Ø¸Ø±Ø§Øª ÙÙ‚Ø· Ø±ÙˆÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ù†Ø³Ø®Ù‡Ù” Ø¯Ù…Ùˆ).</span>
      </div>`;
    postsGrid.appendChild(wrap);
    renderComments(p.id);
    q('#cform-'+p.id).addEventListener('submit', e=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      const name = (fd.get('name')||'Ø¨ÛŒâ€ŒÙ†Ø§Ù…').toString().trim();
      const text = (fd.get('text')||'').toString().trim();
      if(!text) return;
      const list = getComments(p.id);
      list.push({name, text, ts: Date.now()});
      saveComments(p.id, list);
      e.target.reset();
      renderComments(p.id);
    });
  }
  function renderComments(postId){
    const list = getComments(postId);
    const area = q('#clist-'+postId); if(!area) return;
    area.innerHTML = '';
    list.slice().reverse().forEach(c=>{
      const d = new Date(c.ts);
      const el = document.createElement('div');
      el.className='comment';
      el.innerHTML = `<strong>${c.name}</strong> Â· <span class="fine">${d.toLocaleDateString('fa-IR')} ${d.toLocaleTimeString('fa-IR',{hour:'2-digit',minute:'2-digit'})}</span>
        <div>${c.text.replace(/</g,'&lt;')}</div>`;
      area.appendChild(el);
    });
    const title = q('#cwrap-'+postId+' > strong');
    if(title) title.textContent = `Ù†Ø¸Ø±Ø§Øª (${list.length})`;
  }
  function renderPosts(){
    postsGrid.innerHTML = '';
    state.posts.forEach(renderPost);
  }
  renderPosts();

  // ---------- Auth ----------
  const userBtn = q('#userBtn'), userLabel = q('#userLabel');
  const tabs = qa('.tab'); const signupPane = q('#signupPane'), loginPane = q('#loginPane'), accountPane = q('#accountPane');
  function setTab(name){
    tabs.forEach(t=>t.classList.toggle('active', t.dataset.tab===name));
    signupPane.classList.toggle('hidden', name!=='signup');
    loginPane.classList.toggle('hidden', name!=='login');
  }
  tabs.forEach(t=>t.addEventListener('click', ()=>setTab(t.dataset.tab)));

  function updateAuthUI(){
    if(state.user){
      userLabel.textContent = state.user.name.split(' ')[0];
      q('#accountName').textContent = state.user.name;
      q('#accountEmail').textContent = state.user.email;
      signupPane.classList.add('hidden'); loginPane.classList.add('hidden'); accountPane.classList.remove('hidden');
    }else{
      userLabel.textContent = 'ÙˆØ±ÙˆØ¯';
      accountPane.classList.add('hidden'); setTab('signup');
    }
  }
  updateAuthUI();

  q('#signupForm').addEventListener('submit', e=>{
    e.preventDefault();
    const fd = new FormData(e.target);
    const name = fd.get('name').toString().trim();
    const email = fd.get('email').toString().trim().toLowerCase();
    const password = fd.get('password').toString();
    if(password.length<6){ alert('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ±.'); return; }
    // Mock create
    const users = JSON.parse(localStorage.getItem('users')||'{}');
    if(users[email]){ alert('Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª. ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.'); setTab('login'); return; }
    users[email] = {name, email, password};
    localStorage.setItem('users', JSON.stringify(users));
    state.user = {name, email}; saveUser(); updateAuthUI(); alert('Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒ!');
  });

  q('#loginForm').addEventListener('submit', e=>{
    e.preventDefault();
    const fd = new FormData(e.target);
    const email = fd.get('email').toString().trim().toLowerCase();
    const password = fd.get('password').toString();
    const users = JSON.parse(localStorage.getItem('users')||'{}');
    if(!users[email] || users[email].password!==password){ alert('Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø±Ù…Ø² Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª.'); return; }
    state.user = {name: users[email].name, email}; saveUser(); updateAuthUI(); alert('ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚.');
  });

  q('#logoutBtn').addEventListener('click', ()=>{
    state.user = null; saveUser(); updateAuthUI(); alert('Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯.');
  });

  userBtn.addEventListener('click', ()=>{ location.hash = '#auth'; });

  // ---------- Contact ----------
  q('#contactForm').addEventListener('submit', e=>{
    e.preventDefault();
    const fd = new FormData(e.target);
    const name = fd.get('name'); const email = fd.get('email'); const msg = fd.get('message');
    alert(`Ù…Ù…Ù†ÙˆÙ† ${name}! Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯ (Ù†Ø³Ø®Ù‡â€ŒÛŒ Ø¯Ù…Ùˆ).`);
    e.target.reset();
  });

  // ---------- Quality ----------
  // Restore cart UI after reload, wire up shortcut keys
  window.addEventListener('keydown', (e)=>{
    if(e.key==='c' && (e.ctrlKey||e.metaKey)) { e.preventDefault(); openCart(); }
    if(e.key==='Escape') closeCart();
  });
  </script>
</body>
</html>
